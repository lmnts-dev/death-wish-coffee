{%- layout 'theme' -%}

{%- comment -%}
This template has some complicated version depending on which type of blog we're showing. 
If this comment is still here, please consult with the lead developer on the project before proceeding.
{%- endcomment -%}

{%- render 'carousel' -%}

{%- assign blog_acf = blog.metafields -%}
{%- assign list_article = blog_acf.article_hero_card.article -%}
{%- assign fallback_images = blog_acf.accentuate.default_image | first -%}

{%- capture content_slides -%}
  {% for handle in list_article %}
    {%- assign notice = blog.metafields.article_hero_card.notice_title[forloop.index0] -%}
    {%- assign article = articles[handle] -%}
    {% assign class = 'swiper-slide' %}
    {% assign title = article.title %}
    {%- assign image = fallback_images.src -%}
    {%- if article.image.src != blank -%}
      {% assign image = article.image.src | img_url: 'master' %}
    {%- endif -%}
    {% assign url = article.url %}
    {% assign description = article.excerpt %}
    {% capture info %}
      {{ article.author }} - {{ article.created_at | time_tag: format: 'month_day_year' }}
    {% endcapture %}
    {% assign blog_handle = handle | split: '/' | first %}

    {%- render 'article-hero-card',
        class: class,
        notice: notice,
        title: title,
        image: image,
        url: url,
        description: description,
        info: info,
        blog_handle: blog_handle
    -%}
  {% endfor %}
{%- endcapture -%}
{%- render 'carousel', class: 'carousel--article-hero-card article-hero-card__contents bg--black', children: content_slides, spacing: 0, slides_per_view: 1, navigation: true -%}

{%- render 'carousel' -%}

<div class="bg--black">
  {% paginate blog.articles by 16 %}
    {% capture grid_content %}
      {% for post in blog.articles %}
        {% comment %}
        TODO: Remove hard-coded post-card classes to replace with post-card--viewed JavaScript
        {% endcomment %}
        {% assign post_class = '' %}
        {% if forloop.first %}
          {% assign post_class = post_class | append: ' post-card--viewed' %}
        {% endif %}

        {%- assign post_image = fallback_images.src -%}
        {%- assign image_alt = fallback_images.alt -%}

        {%- if post.image != blank -%}
          {%- assign post_image = post | img_url: 'master' -%}
          {%- assign image_alt = post.image.alt -%}
        {%- endif -%}

        {%- render 'post-card',
          title: post.title,
          url: post.url,
          image_src: post_image,
          image_alt: post.image.alt,
          author: post.author,
          published_date: published_date,
          class: post_class -%}
      {% endfor %}
    {% endcapture %}

    {%- render 'grid',
      class: 'bg--black',
      children: grid_content
    -%}

    {%- render 'pagination', paginate: paginate -%}
  {% endpaginate %}
</div>

{%- render 'footer-cta', title: 'MISSING OUT NEW STUFF TOTALLY SUCKS. SO, DONâ€™T MISS OUT.', enable_subscribe_form: true %}
