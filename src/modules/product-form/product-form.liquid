{%- assign is_vue_component = is_vue_component | default: false -%}
{%- assign custom_attrs = custom_attrs | default: '' -%}
{%- assign form_type = form_type | default: 'button' -%}
{%- capture button_class -%}product-form__button js-form-submit{% if form_type != 'button' %} button--light{% endif %}{%- endcapture -%}
{%- assign product = product | default: false -%}
{%- assign button_class = button_class | default: false -%}
{%- assign show_title = show_title | default: false -%}
{%- assign class = class | default: false -%}
{%- capture class -%}product-form {% if class %} {{ class }}{% endif %}{%- endcapture -%}

<!-- Upscribe -->
  {% comment %}
  Snippet variables that can be passed
  upscribe_exclude_vue_cdn_in_snippet = Whether or not to load the vue.js script from CDN
  (excluded if loaded globally, defaults to true)
  {% endcomment %}
{% comment %} Reset snippet variables{% endcomment %}
{% assign upscribe_include_vue_cdn_in_snippet = true %}
  {% comment %} Used in case there are multiple Upscribe blocks loaded per page {% endcomment %}
{% assign upscribe_component_uid = false %}
{% assign upscribe_keep_component_in_sync = false %}
{% assign upscribe_regular_price_query_selector = false %}
{% assign upscribe_sale_price_query_selector = false %}
{% unless upscribe_component_uid %}
  {% assign upscribe_component_uid = product.id %}
{% endunless %}
{% if upscribe_include_vue_cdn_in_snippet != false %}
  {% assign upscribe_include_vue_cdn_in_snippet = true %}
{% endif %}
{% if upscribe_keep_component_in_sync != false %}
  {% assign upscribe_keep_component_in_sync = true %}
{% endif %}

{%- capture content -%}
  <div class="product-form__form">
    <div class="product-form__options">
      <div v-for="(option, optionIndex) in product.options" :key="option" class="product-form__option">
        {%- if show_title -%}
          <h4 class="product-form__option-title h4">${option}</h4>
        {%- endif -%}
        {%- if form_type == 'button' -%}
          <div class="product-form__option-values">
            <div v-for="value in product.options_by_name[option].option.values" :key="option + ':' + value"
                class="product-form__option-value">
              <input :id="optionInputId(option, value)"
                    :name="option + value"
                    :value="value"
                    v-model="selectedOptions[option]"
                    class="radio product-form__option-value-input js-product-input"
                    type="radio"
              >
              <label :for="optionInputId(option, value)"
                    class="label label--radio product-form__option-value-label"
              >
                {% render 'svg', type: 'logo', class: 'product-form__option-value-icon' %}
                <div class="product-form__option-value-text">
                  <div class="product-form__option-value-name">
                    ${value}
                  </div>
                  <div v-if="option === priceDecidingFactor"
                      class="product-form__option-price b1"
                  >
                    $${getPriceForOptionValue(optionIndex, value)}
                  </div>
                </div>
              </label>
            </div>
          </div>
        {%- else -%}
          <div class="product-form__select">
            <select name="variant" class="product-form__select-dropdown" @change="handleVariantSelecting">
              <option value selected>Select Field</option>
              <template v-for="variant in product.variants">
                <option :key="variant.id" value="variant.id" data-title="variant.title" data-variant="variant">${variant.title}</option>
              </template>
            </select>
          </div>
        {%- endif -%}
      </div>
    </div>
    {%- unless is_vue_component -%}
      <div v-if="!addedToCartSuccessfully && addedToCartErrorMessage" class="b1 product-form__message">${addedToCartErrorMessage}</div>
    {%- endunless -%}

    {% if product.metafields.sf_upscribe.enable_subscription == 1 %}

    {%- render 'upscribe-product-options' product: product -%}
    {% endif %}

    <form method="post" action="/cart/add" @submit.prevent="handleAddToCart">
      <input type="hidden" name="id" :value="selectedVariantId">
      <input type="hidden" name="quantity" value="1">
      {%- render 'button',
        button_value: 'Add To Cart',
        tag: 'button',
        custom_attrs: 'type="submit" :disabled="!selectedVariantId"',
        class: button_class
      -%}
    </form>
  </div>
{%- endcapture -%}

{%- if is_vue_component -%}
  <div is="product-form" inline-template {{ custom_attrs }}>
    <div v-if="product" class="{{- class -}}">
      {{ content }}
    </div>
  </div>
{%- elsif product -%}
  {%- capture product_json -%}
    {%- render 'product-json', product: product -%}
  {%- endcapture -%}
  <div class="{{- class -}}" data-module="product-form" {{ custom_attrs }}>
    <div is="product-form"
         :product="{{- product_json | escape -}}"
         :shop='{{shop.metafields.sf_upscribe | json}}' 
         :upscribe-sale-price-query-selector="{{upscribe_sale_price_query_selector}}"
         :upscribe-regular-price-query-selector="{{upscribe_regular_price_query_selector}}"
         :upscribe-keep_component-in-sync="{{upscribe_keep_component_in_sync}}"
         :product-id="{{product.id}}"
         inline-template
    >
      {{ content }}
    </div>
  </div>

{%- endif -%}
